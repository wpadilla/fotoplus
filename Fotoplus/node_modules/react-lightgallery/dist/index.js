"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function _interopNamespace(e){if(e&&e.__esModule)return e;var t={};return e&&Object.keys(e).forEach((function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})})),t.default=e,t}Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),React__default=_interopDefault(React),PT=_interopDefault(require("prop-types")),uniqid=_interopDefault(require("uniqid")),reactDom=require("react-dom"),browserOrNode=require("browser-or-node");function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var lightgalleryContext=React.createContext(),addPrefix=function(e){return"react_lightgallery_".concat(e)},LightgalleryItem=function(e){function t(){var e,r;_classCallCheck(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return _defineProperty(_assertThisInitialized(r=_possibleConstructorReturn(this,(e=_getPrototypeOf(t)).call.apply(e,[this].concat(o)))),"state",{id:uniqid()}),_defineProperty(_assertThisInitialized(r),"register",(function(){var e=r.props,t=e.src,n=e.thumb,o=void 0===n?t:n,i=e.subHtml,s=void 0===i?"":i,l=e.downloadUrl,a=void 0===l?"":l;r.context.registerPhoto(r.state.id,r.props.group,{src:t,thumb:o,subHtml:s,downloadUrl:a})})),_defineProperty(_assertThisInitialized(r),"unregister",(function(){r.context.unregisterPhoto(r.state.id,r.props.group)})),_defineProperty(_assertThisInitialized(r),"open",(function(){r.context.openGallery(r.state.id,r.props.group)})),r}return _inherits(t,React.Component),_createClass(t,[{key:"componentDidMount",value:function(){this.register()}},{key:"componentWillUnmount",value:function(){this.unregister()}},{key:"render",value:function(){var e=this.props,t=e.itemClassName,r=void 0===t?addPrefix("item"):t,n=e.children;return React__default.createElement("div",{className:r,onClick:this.open},n)}}]),t}();function isObject(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}_defineProperty(LightgalleryItem,"propTypes",{children:PT.any,group:PT.string.isRequired,src:PT.string.isRequired,thumb:PT.string,subHtml:PT.oneOfType([PT.string,PT.object]),downloadUrl:PT.string,itemClassName:PT.string}),_defineProperty(LightgalleryItem,"contextType",lightgalleryContext);var isObject_1=isObject,commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},freeGlobal="object"==typeof commonjsGlobal&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,_freeGlobal=freeGlobal,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=_freeGlobal||freeSelf||Function("return this")(),_root=root,now=function(){return _root.Date.now()},now_1=now,Symbol$1=_root.Symbol,_Symbol=Symbol$1,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,nativeObjectToString=objectProto.toString,symToStringTag=_Symbol?_Symbol.toStringTag:void 0;function getRawTag(e){var t=hasOwnProperty.call(e,symToStringTag),r=e[symToStringTag];try{e[symToStringTag]=void 0;var n=!0}catch(e){}var o=nativeObjectToString.call(e);return n&&(t?e[symToStringTag]=r:delete e[symToStringTag]),o}var _getRawTag=getRawTag,objectProto$1=Object.prototype,nativeObjectToString$1=objectProto$1.toString;function objectToString(e){return nativeObjectToString$1.call(e)}var _objectToString=objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag$1=_Symbol?_Symbol.toStringTag:void 0;function baseGetTag(e){return null==e?void 0===e?undefinedTag:nullTag:symToStringTag$1&&symToStringTag$1 in Object(e)?_getRawTag(e):_objectToString(e)}var _baseGetTag=baseGetTag;function isObjectLike(e){return null!=e&&"object"==typeof e}var isObjectLike_1=isObjectLike,symbolTag="[object Symbol]";function isSymbol(e){return"symbol"==typeof e||isObjectLike_1(e)&&_baseGetTag(e)==symbolTag}var isSymbol_1=isSymbol,NAN=NaN,reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;function toNumber(e){if("number"==typeof e)return e;if(isSymbol_1(e))return NAN;if(isObject_1(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=isObject_1(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(reTrim,"");var r=reIsBinary.test(e);return r||reIsOctal.test(e)?freeParseInt(e.slice(2),r?2:8):reIsBadHex.test(e)?NAN:+e}var toNumber_1=toNumber,FUNC_ERROR_TEXT="Expected a function",nativeMax=Math.max,nativeMin=Math.min;function debounce(e,t,r){var n,o,i,s,l,a,u=0,c=!1,f=!1,p=!0;if("function"!=typeof e)throw new TypeError(FUNC_ERROR_TEXT);function d(t){var r=n,i=o;return n=o=void 0,u=t,s=e.apply(i,r)}function g(e){var r=e-a;return void 0===a||r>=t||r<0||f&&e-u>=i}function y(){var e=now_1();if(g(e))return _(e);l=setTimeout(y,function(e){var r=t-(e-a);return f?nativeMin(r,i-(e-u)):r}(e))}function _(e){return l=void 0,p&&n?d(e):(n=o=void 0,s)}function b(){var e=now_1(),r=g(e);if(n=arguments,o=this,a=e,r){if(void 0===l)return function(e){return u=e,l=setTimeout(y,t),c?d(e):s}(a);if(f)return clearTimeout(l),l=setTimeout(y,t),d(a)}return void 0===l&&(l=setTimeout(y,t)),s}return t=toNumber_1(t)||0,isObject_1(r)&&(c=!!r.leading,i=(f="maxWait"in r)?nativeMax(toNumber_1(r.maxWait)||0,t):i,p="trailing"in r?!!r.trailing:p),b.cancel=function(){void 0!==l&&clearTimeout(l),u=0,n=a=o=l=void 0},b.flush=function(){return void 0===l?s:_(now_1())},b}var debounce_1=debounce,PLUGINS_LIST=["lg-autoplay.js","lg-fullscreen.js","lg-hash.js","lg-pager.js","lg-thumbnail.js","lg-video.js","lg-zoom.js","lg-share.js"],DEFAULT_PLUGINS=["lg-fullscreen.js","lg-thumbnail.js","lg-video.js","lg-zoom.js"],LightgalleryProvider=function(e){function t(){var e,r;_classCallCheck(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return _defineProperty(_assertThisInitialized(r=_possibleConstructorReturn(this,(e=_getPrototypeOf(t)).call.apply(e,[this].concat(o)))),"groups",{}),_defineProperty(_assertThisInitialized(r),"gallery_element",React.createRef()),_defineProperty(_assertThisInitialized(r),"listeners",{}),_defineProperty(_assertThisInitialized(r),"will_unmount",!1),_defineProperty(_assertThisInitialized(r),"_forceUpdate",debounce_1(r.forceUpdate,50)),_defineProperty(_assertThisInitialized(r),"getLgUid",(function(){if(r.gallery_element.current)return r.gallery_element.current.getAttribute("lg-uid")})),_defineProperty(_assertThisInitialized(r),"registerPhoto",(function(e,t,n){r.groups=_objectSpread2({},r.groups,_defineProperty({},t,[].concat(_toConsumableArray(r.groups[t]||[]),[_objectSpread2({},n,{id:e})]))),r._forceUpdate()})),_defineProperty(_assertThisInitialized(r),"unregisterPhoto",(function(e,t){r.will_unmount||(r.groups=_objectSpread2({},r.groups,_defineProperty({},t,r.groups[t].filter((function(t){return t.id!==e})))),r._forceUpdate())})),_defineProperty(_assertThisInitialized(r),"destroyExistGallery",(function(){"object"===("undefined"==typeof window?"undefined":_typeof(window))&&window.lgData&&window.lgData[r.getLgUid()]&&(r.removeListeners(),window.lgData[r.getLgUid()].destroy(!0))})),_defineProperty(_assertThisInitialized(r),"setUpListener",(function(e,t){var n=function(n){r.props[e]&&r.props[e](n),t&&t()};r.gallery_element.current.addEventListener(e,n),r.listeners[e]&&console.error("Event ".concat(e," already exist in listeners")),r.listeners[e]=n})),_defineProperty(_assertThisInitialized(r),"removeListener",(function(e){var t=r.gallery_element.current;r.listeners[e]&&(t.removeEventListener(e,r.listeners[e]),delete r.listeners[e])})),_defineProperty(_assertThisInitialized(r),"removeListeners",(function(){for(var e in r.listeners)r.removeListener(e)})),_defineProperty(_assertThisInitialized(r),"setupListeners",(function(){r.setUpListener("onBeforeOpen"),r.setUpListener("onAfterOpen"),r.setUpListener("onSlideItemLoad"),r.setUpListener("onBeforeSlide"),r.setUpListener("onAfterSlide"),r.setUpListener("onBeforePrevSlide"),r.setUpListener("onBeforeNextSlide"),r.setUpListener("onDragstart"),r.setUpListener("onDragmove"),r.setUpListener("onDragend"),r.setUpListener("onSlideClick"),r.setUpListener("onBeforeClose"),r.setUpListener("onCloseAfter",(function(){setTimeout((function(){r.destroyExistGallery()}),0)}))})),_defineProperty(_assertThisInitialized(r),"openGallery",(function(e,t){if(r.gallery_element.current)if(r.groups.hasOwnProperty(t)){r.destroyExistGallery();var n=r.groups[t];lightGallery(r.gallery_element.current,_objectSpread2({},r.props.lightgallerySettings||{},{dynamic:!0,dynamicEl:n,index:n.findIndex((function(t){return t.id===e}))})),r.setupListeners()}else console.error("Trying to open undefined group");else console.error("Error on trying to open gallery; ref 'gallery_element' is not defined")})),r}return _inherits(t,React.Component),_createClass(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.plugins,r=e.onLightgalleryImport;browserOrNode.isBrowser&&!window.lgData&&new Promise((function(e){e(_interopNamespace(require("lightgallery.js")))})).then((function(){t.includes("lg-autoplay.js")&&new Promise((function(e){e(_interopNamespace(require("lg-autoplay.js")))})).then(),t.includes("lg-fullscreen.js")&&new Promise((function(e){e(_interopNamespace(require("lg-fullscreen.js")))})).then(),t.includes("lg-hash.js")&&new Promise((function(e){e(_interopNamespace(require("lg-hash.js")))})).then(),t.includes("lg-pager.js")&&new Promise((function(e){e(_interopNamespace(require("lg-pager.js")))})).then(),t.includes("lg-thumbnail.js")&&new Promise((function(e){e(_interopNamespace(require("lg-thumbnail.js")))})).then(),t.includes("lg-video.js")&&new Promise((function(e){e(_interopNamespace(require("lg-video.js")))})).then(),t.includes("lg-zoom.js")&&new Promise((function(e){e(_interopNamespace(require("lg-zoom.js")))})).then(),t.includes("lg-share.js")&&new Promise((function(e){e(_interopNamespace(require("lg-share.js")))})).then(),r&&r()}))}},{key:"componentWillUnmount",value:function(){this.will_unmount=!0,this._forceUpdate.cancel(),this.destroyExistGallery()}},{key:"render",value:function(){var e=this.props,t=e.galleryClassName,r=void 0===t?addPrefix("gallery"):t,n=e.portalElementSelector,o=null;if(browserOrNode.isBrowser&&(o=document.body,n)){var i=document.querySelector(n);i||console.error("There is cannot to find element by selector: `${portalElementSelector}` lightgallery element will be added to document.body"),o=i}return React__default.createElement(lightgalleryContext.Provider,{value:{registerPhoto:this.registerPhoto,unregisterPhoto:this.unregisterPhoto,openGallery:this.openGallery}},this.props.children,o&&reactDom.createPortal(React__default.createElement("div",{className:r,ref:this.gallery_element}),o))}}]),t}();_defineProperty(LightgalleryProvider,"defaultProps",{plugins:DEFAULT_PLUGINS}),_defineProperty(LightgalleryProvider,"propTypes",{children:PT.any,plugins:PT.arrayOf(PT.oneOf(PLUGINS_LIST)),lightgallerySettings:PT.object,galleryClassName:PT.string,portalElementSelector:PT.string,onBeforeOpen:PT.func,onAfterOpen:PT.func,onSlideItemLoad:PT.func,onBeforeSlide:PT.func,onAfterSlide:PT.func,onBeforePrevSlide:PT.func,onBeforeNextSlide:PT.func,onDragstart:PT.func,onDragmove:PT.func,onDragend:PT.func,onSlideClick:PT.func,onBeforeClose:PT.func,onCloseAfter:PT.func,onLightgalleryImport:PT.func}),exports.LightgalleryItem=LightgalleryItem,exports.LightgalleryProvider=LightgalleryProvider;
